<div class="page">
  <header class="topbar">
    <div>
      <h1>Manage your task</h1>
    </div>
    <button class="ghost" type="button" (click)="logout()">Logout</button>
  </header>

  <app-task-filters
    [status]="status()"
    [sortBy]="sortBy()"
    [search]="search()"
    (filtersChange)="onFiltersChange($event)"
    (darkModeToggle)="onDarkModeToggle($event)"
  />

  @if (loading()) {
    <div class="state">
      <div class="spinner" aria-label="Loading"></div>
      <span>Loading tasks...</span>
    </div>
  }

  @if (error()) {
    <div class="state error">{{ error() }}</div>
  }

  @if (!loading()) {
    <section class="grid">
      @for (task of pagedTasks(); track $index) {
        <app-task-card
          [task]="task"
          (toggle)="onToggle($event)"
          (delete)="onDelete($event)"
          (edit)="openEdit($event)"
        />
      }
    </section>
  }

  @if (!loading()) {
    <footer class="pager">
      <button class="ghost" type="button" (click)="prev()">Prev</button>
      <span class="muted">Page</span>
      <strong>{{ page() }}</strong>
      <span class="muted">of</span>
      <strong>{{ totalPages() }}</strong>
      <button class="ghost" type="button" (click)="next()">Next</button>
    </footer>
  }

  @if (editTask()) {
    <app-task-edit-modal [task]="editTask()" (close)="closeEdit()" (save)="saveEdit($event)" />
  }
</div>
